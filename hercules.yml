version: 1

name: edge
debug: false
port: 9100

globalLabels:
  - cell: ausw1
  - env: dev

packages:
  - name: snowflake
    location: hercules-snowflake-pkg.yml
    variables:
      name: blah

extensions:
  core:
    - name: inet
    - name: vss
    - name: icu
    - name: fts

  community:
    - name: chsql # Clickhouse macros and functions
    - name: lindel # Linearization/Delinearization, Z-Order, Hilbert and Morton Curves
    - name: prql # Pipelined Relational Query Language

macros:
  - sql: create or replace macro one() AS (SELECT 1);
  - sql: create or replace macro two() AS (SELECT 2);

sources:
  - name: united_states_zip_codes
    type: csv
    source: https://raw.githubusercontent.com/scpike/us-state-county-zip/refs/heads/master/geo-data.csv
    materialize: true
    refreshIntervalSeconds: 100

  - name: nyc_yellow_taxi_june_2024
    type: parquet
    source: https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2024-07.parquet
    materialize: true
    refreshIntervalSeconds: 100

metrics:
  gauge:
    - name: nyc_pickup_location_fare_total
      help: Total NYC fares for the month of August by pickup location
      enabled: True
      sql: select struct_pack(pickupLocation := PULocationID::text), sum(fare_amount) as val from nyc_yellow_taxi_june_2024 group by 1
      labels:
        - pickupLocation

    - name: one_one_one_one
      help: Testing the one() macro
      enabled: true
      sql: select struct_pack(user := 'yo') as labels, one();
      labels:
        - user

    - name: two_two_two_two
      help: Testing the two() macro
      enabled: true
      sql: select struct_pack(user := 'yeeee') as labels, two();
      labels:
        - user

    - name: united_states_zip_codes_total
      help: The number of US zip codes
      sql: select struct_pack(state := state) as labels, count(*) as value from united_states_zip_codes group by 1;
      labels:
        - state
